<div class="container" style="padding: 20px; font-family: sans-serif;">
  
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px;">
    <h1>Panel CRM</h1>
    <button (click)="logout()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
      Cerrar Sesión
    </button>
  </div>

  <div *ngIf="errorMessage" style="background: #ffe6e6; color: #d63031; padding: 15px; border: 1px solid #fab1a0; border-radius: 5px; margin-bottom: 20px;">
    <h3>⚠️ Algo ha fallado:</h3>
    <p>{{ errorMessage }}</p>
    <p><small>Por favor, cierra sesión manualmente e inténtalo de nuevo.</small></p>
  </div>

  <div *ngIf="isAdmin">
    
    <div style="background-color: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid purple; display: flex; justify-content: space-between; align-items: center;">
      <h3 style="margin: 0; color: purple;">Modo: ADMINISTRADOR</h3>
      <button (click)="createCustomer()" style="background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold;">
        + Nuevo Cliente
      </button>
    </div>

    <div *ngIf="!selectedCustomer">
      <table style="width: 100%; border-collapse: collapse;">
        <thead style="background: #f1f1f1;">
          <tr>
            <th style="padding: 10px; text-align: left;">Nombre</th>
            <th style="padding: 10px; text-align: left;">Correo</th>
            <th style="padding: 10px; text-align: center;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of customers" style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px;">{{ c.nombre }}</td>
            <td style="padding: 10px;">{{ c.correo }}</td>
            <td style="padding: 10px; text-align: center;">
              
              <button (click)="viewDetails(c)" style="margin-right: 5px; background: none; border: 1px solid #007bff; color: #007bff; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                Ver
              </button>

              <button (click)="editCustomer(c.id)" style="margin-right: 5px; background: none; border: 1px solid #ffc107; color: #d39e00; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                Editar
              </button>

              <button (click)="deleteCustomer(c.id)" style="background: none; border: 1px solid #dc3545; color: #dc3545; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                Eliminar
              </button>

            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="selectedCustomer" style="background: #f9f9f9; padding: 20px; margin-top: 10px; border-radius: 8px; border: 1px solid #ddd;">
      <button (click)="clearSelection()" style="cursor: pointer; margin-bottom: 15px;">⬅ Volver</button>
      <h2>{{ selectedCustomer.nombre }}</h2>
      <p><strong>ID:</strong> {{ selectedCustomer.id }}</p>
      <p><strong>Correo:</strong> {{ selectedCustomer.correo }}</p>
      
      <h3>Facturas:</h3>
      <ul>
        <li *ngFor="let f of selectedCustomer.facturas">{{ f }}</li>
        <li *ngIf="!selectedCustomer.facturas || selectedCustomer.facturas.length === 0">Sin facturas.</li>
      </ul>
    </div>
  </div>

  <div *ngIf="!isAdmin && !errorMessage">
    <div *ngIf="currentUser">
      <h2 style="color: #007bff;">Hola, {{ currentUser.nombre }}</h2>
      <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        <p><strong>Correo:</strong> {{ currentUser.correo }}</p>
        <p><strong>ID Cliente:</strong> {{ currentUser.id }}</p>
        <p><strong>Antigüedad:</strong> {{ currentUser.antiguedad }} años</p>
        <p><strong>Estado:</strong> 
           <span [style.color]="currentUser.deudas > 0 ? 'red' : 'green'">
             {{ currentUser.deudas > 0 ? 'Pagos pendientes' : 'Al día' }}
           </span>
        </p>
        
        <h3 style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px;">Mis Facturas</h3>
        <div *ngFor="let f of currentUser.facturas" style="background: #f8f9fa; padding: 10px; margin-bottom: 5px; border-left: 4px solid #28a745;">
          {{ f }}
        </div>
        <p *ngIf="!currentUser.facturas || currentUser.facturas.length === 0" style="color: #888;">
          Sin compras recientes.
        </p>
      </div>
    </div>
    
    <div *ngIf="!currentUser" style="text-align: center; color: #999; padding: 30px;">
      <p>Cargando perfil...</p>
    </div>
  </div>

</div>